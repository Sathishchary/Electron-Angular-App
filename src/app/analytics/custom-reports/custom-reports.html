<div class="custom-reports">
  <h1>Custom Reports</h1>
  <p class="page-description">Generate custom reports with flexible filtering and export options</p>

  <!-- Filter Form -->
  <mat-card class="filter-card">
    <mat-card-header>
      <mat-card-title>Report Filters</mat-card-title>
      <mat-card-subtitle>Configure your report parameters</mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>
      <form [formGroup]="filterForm" class="filter-form">
        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Report Type</mat-label>
            <mat-select formControlName="reportType">
              <mat-option *ngFor="let type of reportTypes" [value]="type.value">
                {{type.label}}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Date Range</mat-label>
            <mat-select formControlName="dateRange">
              <mat-option *ngFor="let range of dateRanges" [value]="range.value">
                {{range.label}}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <div class="form-row" *ngIf="isCustomDateRange()">
          <mat-form-field appearance="outline">
            <mat-label>Start Date</mat-label>
            <input matInput [matDatepicker]="startPicker" formControlName="startDate">
            <mat-datepicker-toggle matIconSuffix [for]="startPicker"></mat-datepicker-toggle>
            <mat-datepicker #startPicker></mat-datepicker>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>End Date</mat-label>
            <input matInput [matDatepicker]="endPicker" formControlName="endDate">
            <mat-datepicker-toggle matIconSuffix [for]="endPicker"></mat-datepicker-toggle>
            <mat-datepicker #endPicker></mat-datepicker>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Category (Optional)</mat-label>
            <input matInput formControlName="category" placeholder="e.g., Premium, Basic">
          </mat-form-field>

          <div class="value-range">
            <mat-form-field appearance="outline">
              <mat-label>Min Value</mat-label>
              <input matInput type="number" formControlName="minValue">
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Max Value</mat-label>
              <input matInput type="number" formControlName="maxValue">
            </mat-form-field>
          </div>
        </div>

        <div class="form-actions">
          <button mat-raised-button color="primary" (click)="generateReport()" [disabled]="loading">
            <mat-icon *ngIf="!loading">assessment</mat-icon>
            <mat-spinner *ngIf="loading" diameter="20"></mat-spinner>
            Generate Report
          </button>
          
          <button mat-stroked-button (click)="clearFilters()">
            <mat-icon>clear</mat-icon>
            Clear Filters
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>

  <!-- Report Results -->
  <mat-card class="results-card" *ngIf="reportGenerated">
    <mat-card-header>
      <mat-card-title>Report Results</mat-card-title>
      <mat-card-subtitle>{{reportData.length}} records found</mat-card-subtitle>
      <div class="header-actions">
        <button mat-stroked-button (click)="exportToCSV()" class="export-btn">
          <mat-icon>download</mat-icon>
          Export CSV
        </button>
        <button mat-stroked-button (click)="exportToExcel()" class="export-btn">
          <mat-icon>download</mat-icon>
          Export Excel
        </button>
      </div>
    </mat-card-header>
    <mat-card-content>
      <table mat-table [dataSource]="reportData" class="report-table">
        
        <ng-container matColumnDef="id">
          <th mat-header-cell *matHeaderCellDef> ID </th>
          <td mat-cell *matCellDef="let element"> {{element.id}} </td>
        </ng-container>

        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef> Name </th>
          <td mat-cell *matCellDef="let element"> {{element.name}} </td>
        </ng-container>

        <ng-container matColumnDef="value">
          <th mat-header-cell *matHeaderCellDef> Value </th>
          <td mat-cell *matCellDef="let element"> {{element.value}} </td>
        </ng-container>

        <ng-container matColumnDef="category">
          <th mat-header-cell *matHeaderCellDef> Category </th>
          <td mat-cell *matCellDef="let element"> {{element.category}} </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table>

      <div class="no-data" *ngIf="reportData.length === 0">
        <mat-icon>inbox</mat-icon>
        <p>No data found matching your criteria</p>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Instructions -->
  <mat-card class="instructions-card" *ngIf="!reportGenerated">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>info</mat-icon>
        How to Use Custom Reports
      </mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <ul>
        <li><strong>Report Type:</strong> Select the type of data you want to analyze (Users, Customers, Revenue, etc.)</li>
        <li><strong>Date Range:</strong> Choose a predefined range or select custom dates for specific periods</li>
        <li><strong>Filters:</strong> Apply additional filters like category or value ranges to narrow down results</li>
        <li><strong>Export:</strong> Download your reports in CSV or Excel format for further analysis</li>
      </ul>
      
      <div class="api-note">
        <mat-icon>code</mat-icon>
        <div>
          <h4>For Developers</h4>
          <p>To integrate with real data, update the <code>generateReport()</code> method in <code>AnalyticsData</code> service to call your API endpoint:</p>
          <code>return this.http.post('/api/reports/generate', filters)</code>
        </div>
      </div>
    </mat-card-content>
  </mat-card>
</div>
