<div class="email-insights">
  <h1>Email Insights Dashboard</h1>
  <p class="page-description">Analyze email usage patterns, domain statistics, and user relationships</p>
  
  <!-- Key Metrics Cards -->
  <div class="metrics-grid" *ngIf="!loading">
    <mat-card class="metric-card">
      <mat-card-header>
        <mat-card-title>Total Emails</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="metric-value">{{analyticsData.totalEmails | number}}</div>
        <div class="metric-subtitle">Across all users & customers</div>
      </mat-card-content>
    </mat-card>

    <mat-card class="metric-card">
      <mat-card-header>
        <mat-card-title>Unique Domains</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="metric-value">{{analyticsData.uniqueDomains | number}}</div>
        <div class="metric-subtitle">Different organizations</div>
      </mat-card-content>
    </mat-card>

    <mat-card class="metric-card">
      <mat-card-header>
        <mat-card-title>Domain Diversity</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="metric-value">{{(analyticsData.uniqueDomains / analyticsData.totalEmails * 100) | number:'1.1-1'}}%</div>
        <div class="metric-subtitle">Organization coverage</div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Charts Section -->
  <div class="charts-grid" *ngIf="!loading">
    <mat-card class="chart-card">
      <mat-card-header>
        <mat-card-title>Top Email Domains</mat-card-title>
        <mat-card-subtitle>Most active domains by users and customers</mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <div #domainsChart class="chart-container"></div>
      </mat-card-content>
    </mat-card>

    <mat-card class="chart-card">
      <mat-card-header>
        <mat-card-title>Usage Distribution</mat-card-title>
        <mat-card-subtitle>Email usage by organization type</mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <div #usageChart class="chart-container"></div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Domain Details Table -->
  <mat-card class="table-card" *ngIf="!loading">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>domain</mat-icon>
        Domain Analysis
      </mat-card-title>
      <mat-card-subtitle>Detailed breakdown of email domains and relationships</mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>
      <table mat-table [dataSource]="getDomainData()" class="domain-table">
        
        <ng-container matColumnDef="domain">
          <th mat-header-cell *matHeaderCellDef> Domain </th>
          <td mat-cell *matCellDef="let domain"> 
            <div class="domain-info">
              <mat-icon>alternate_email</mat-icon>
              {{domain.domain}}
            </div>
          </td>
        </ng-container>

        <ng-container matColumnDef="users">
          <th mat-header-cell *matHeaderCellDef> Users </th>
          <td mat-cell *matCellDef="let domain"> {{domain.users | number}} </td>
        </ng-container>

        <ng-container matColumnDef="customers">
          <th mat-header-cell *matHeaderCellDef> Customers </th>
          <td mat-cell *matCellDef="let domain"> {{domain.customers | number}} </td>
        </ng-container>

        <ng-container matColumnDef="totalUsage">
          <th mat-header-cell *matHeaderCellDef> Total Usage </th>
          <td mat-cell *matCellDef="let domain"> 
            <strong>{{domain.totalUsage | number}}</strong>
          </td>
        </ng-container>

        <ng-container matColumnDef="type">
          <th mat-header-cell *matHeaderCellDef> Type </th>
          <td mat-cell *matCellDef="let domain"> 
            <mat-chip [style.background-color]="getTypeColor(domain.type)" [style.color]="'white'">
              {{domain.type}}
            </mat-chip>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table>
    </mat-card-content>
  </mat-card>

  <!-- Insights and Recommendations -->
  <div class="insights-grid" *ngIf="!loading">
    <mat-card class="insight-card">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>insights</mat-icon>
          Key Insights
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <ul class="insights-list">
          <li>
            <mat-icon>trending_up</mat-icon>
            <span><strong>{{analyticsData.topDomains[1][0]}}</strong> is the most active domain with {{analyticsData.topDomains[1][1] + analyticsData.topDomains[1][2]}} total contacts</span>
          </li>
          <li>
            <mat-icon>business</mat-icon>
            <span>Business domains represent <strong>{{analyticsData.usageChart[1][1]}}%</strong> of total usage</span>
          </li>
          <li>
            <mat-icon>diversity_3</mat-icon>
            <span>High domain diversity indicates good market penetration across organizations</span>
          </li>
        </ul>
      </mat-card-content>
    </mat-card>

    <mat-card class="insight-card">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>lightbulb</mat-icon>
          Recommendations
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <ul class="recommendations-list">
          <li>
            <mat-icon>group_add</mat-icon>
            <span>Focus customer acquisition on top-performing domains</span>
          </li>
          <li>
            <mat-icon>campaign</mat-icon>
            <span>Create targeted campaigns for underrepresented sectors</span>
          </li>
          <li>
            <mat-icon>analytics</mat-icon>
            <span>Monitor domain-specific engagement patterns for optimization</span>
          </li>
        </ul>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Loading State -->
  <div class="loading-container" *ngIf="loading">
    <mat-spinner></mat-spinner>
    <p>Loading email insights...</p>
  </div>
</div>
