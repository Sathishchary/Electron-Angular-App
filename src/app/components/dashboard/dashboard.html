<div class="dashboard-container">
  <h1 class="dashboard-title">Dashboard</h1>
  
  <!-- Stats Cards -->
  <div class="stats-grid" *ngIf="stats$ | async as stats">
    <mat-card class="stat-card">
      <mat-card-content>
        <div class="stat-content">
          <mat-icon class="stat-icon users-icon">people</mat-icon>
          <div class="stat-info">
            <h3>{{stats.totalUsers}}</h3>
            <p>Total Users</p>
            <small>{{stats.activeUsers}} active</small>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card">
      <mat-card-content>
        <div class="stat-content">
          <mat-icon class="stat-icon customers-icon">business</mat-icon>
          <div class="stat-info">
            <h3>{{stats.totalCustomers}}</h3>
            <p>Total Customers</p>
            <small>{{stats.activeCustomers}} active</small>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card">
      <mat-card-content>
        <div class="stat-content">
          <mat-icon class="stat-icon revenue-icon">attach_money</mat-icon>
          <div class="stat-info">
            <h3>{{formatRevenue(stats.totalRevenue)}}</h3>
            <p>Total Revenue</p>
            <small>from {{stats.totalCustomers}} customers</small>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card">
      <mat-card-content>
        <div class="stat-content">
          <mat-icon class="stat-icon emails-icon">email</mat-icon>
          <div class="stat-info">
            <h3>{{stats.totalEmails}}</h3>
            <p>Email Addresses</p>
            <small>across all entities</small>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Charts Section -->
  <div class="charts-section">
    <h2>Analytics</h2>
    <div class="charts-grid">
      <mat-card class="chart-card">
        <mat-card-header>
          <mat-card-title>Users by Department</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <app-bar-chart 
            [data]="(departmentChartData$ | async) || []" 
            title="Users by Department">
          </app-bar-chart>
        </mat-card-content>
      </mat-card>

      <mat-card class="chart-card">
        <mat-card-header>
          <mat-card-title>User Status Distribution</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <app-pie-chart 
            [data]="(userStatusChartData$ | async) || []" 
            title="User Status Distribution">
          </app-pie-chart>
        </mat-card-content>
      </mat-card>

      <mat-card class="chart-card">
        <mat-card-header>
          <mat-card-title>Customer Status Distribution</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <app-pie-chart 
            [data]="(customerStatusChartData$ | async) || []" 
            title="Customer Status Distribution">
          </app-pie-chart>
        </mat-card-content>
      </mat-card>

      <mat-card class="chart-card">
        <mat-card-header>
          <mat-card-title>Customers by Industry</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <app-bar-chart 
            [data]="(industryChartData$ | async) || []" 
            title="Customers by Industry">
          </app-bar-chart>
        </mat-card-content>
      </mat-card>
    </div>
  </div>

  <!-- Data Tables -->
  <mat-tab-group class="data-tables">
    <mat-tab label="Users">
      <div class="table-container">
        <mat-table [dataSource]="(users$ | async) || []" class="data-table">
          <ng-container matColumnDef="firstName">
            <mat-header-cell *matHeaderCellDef>First Name</mat-header-cell>
            <mat-cell *matCellDef="let user">{{user.firstName}}</mat-cell>
          </ng-container>

          <ng-container matColumnDef="lastName">
            <mat-header-cell *matHeaderCellDef>Last Name</mat-header-cell>
            <mat-cell *matCellDef="let user">{{user.lastName}}</mat-cell>
          </ng-container>

          <ng-container matColumnDef="email">
            <mat-header-cell *matHeaderCellDef>Email</mat-header-cell>
            <mat-cell *matCellDef="let user">{{user.email}}</mat-cell>
          </ng-container>

          <ng-container matColumnDef="department">
            <mat-header-cell *matHeaderCellDef>Department</mat-header-cell>
            <mat-cell *matCellDef="let user">{{user.department}}</mat-cell>
          </ng-container>

          <ng-container matColumnDef="role">
            <mat-header-cell *matHeaderCellDef>Role</mat-header-cell>
            <mat-cell *matCellDef="let user">{{user.role}}</mat-cell>
          </ng-container>

          <ng-container matColumnDef="status">
            <mat-header-cell *matHeaderCellDef>Status</mat-header-cell>
            <mat-cell *matCellDef="let user">
              <mat-chip [color]="getStatusChipColor(user.status)">{{user.status}}</mat-chip>
            </mat-cell>
          </ng-container>

          <mat-header-row *matHeaderRowDef="userColumns"></mat-header-row>
          <mat-row *matRowDef="let row; columns: userColumns;"></mat-row>
        </mat-table>
      </div>
    </mat-tab>

    <mat-tab label="Customers">
      <div class="table-container">
        <mat-table [dataSource]="(customers$ | async) || []" class="data-table">
          <ng-container matColumnDef="companyName">
            <mat-header-cell *matHeaderCellDef>Company</mat-header-cell>
            <mat-cell *matCellDef="let customer">{{customer.companyName}}</mat-cell>
          </ng-container>

          <ng-container matColumnDef="contactFirstName">
            <mat-header-cell *matHeaderCellDef>Contact First Name</mat-header-cell>
            <mat-cell *matCellDef="let customer">{{customer.contactFirstName}}</mat-cell>
          </ng-container>

          <ng-container matColumnDef="contactLastName">
            <mat-header-cell *matHeaderCellDef>Contact Last Name</mat-header-cell>
            <mat-cell *matCellDef="let customer">{{customer.contactLastName}}</mat-cell>
          </ng-container>

          <ng-container matColumnDef="primaryEmail">
            <mat-header-cell *matHeaderCellDef>Primary Email</mat-header-cell>
            <mat-cell *matCellDef="let customer">{{customer.primaryEmail}}</mat-cell>
          </ng-container>

          <ng-container matColumnDef="industry">
            <mat-header-cell *matHeaderCellDef>Industry</mat-header-cell>
            <mat-cell *matCellDef="let customer">{{customer.industry}}</mat-cell>
          </ng-container>

          <ng-container matColumnDef="revenue">
            <mat-header-cell *matHeaderCellDef>Revenue</mat-header-cell>
            <mat-cell *matCellDef="let customer">{{formatRevenue(customer.revenue)}}</mat-cell>
          </ng-container>

          <ng-container matColumnDef="status">
            <mat-header-cell *matHeaderCellDef>Status</mat-header-cell>
            <mat-cell *matCellDef="let customer">
              <mat-chip [color]="getStatusChipColor(customer.status)">{{customer.status}}</mat-chip>
            </mat-cell>
          </ng-container>

          <mat-header-row *matHeaderRowDef="customerColumns"></mat-header-row>
          <mat-row *matRowDef="let row; columns: customerColumns;"></mat-row>
        </mat-table>
      </div>
    </mat-tab>

    <mat-tab label="Email Addresses">
      <div class="table-container">
        <mat-table [dataSource]="(emailAddresses$ | async) || []" class="data-table">
          <ng-container matColumnDef="email">
            <mat-header-cell *matHeaderCellDef>Email Address</mat-header-cell>
            <mat-cell *matCellDef="let email">{{email.email}}</mat-cell>
          </ng-container>

          <ng-container matColumnDef="userName">
            <mat-header-cell *matHeaderCellDef>User</mat-header-cell>
            <mat-cell *matCellDef="let email">{{email.userName || '-'}}</mat-cell>
          </ng-container>

          <ng-container matColumnDef="customerName">
            <mat-header-cell *matHeaderCellDef>Customer</mat-header-cell>
            <mat-cell *matCellDef="let email">{{email.customerName || '-'}}</mat-cell>
          </ng-container>

          <ng-container matColumnDef="type">
            <mat-header-cell *matHeaderCellDef>Type</mat-header-cell>
            <mat-cell *matCellDef="let email">
              <mat-chip>{{email.type}}</mat-chip>
            </mat-cell>
          </ng-container>

          <ng-container matColumnDef="isVerified">
            <mat-header-cell *matHeaderCellDef>Verified</mat-header-cell>
            <mat-cell *matCellDef="let email">
              <mat-icon [color]="email.isVerified ? 'primary' : 'warn'">
                {{email.isVerified ? 'check_circle' : 'cancel'}}
              </mat-icon>
            </mat-cell>
          </ng-container>

          <mat-header-row *matHeaderRowDef="emailColumns"></mat-header-row>
          <mat-row *matRowDef="let row; columns: emailColumns;"></mat-row>
        </mat-table>
      </div>
    </mat-tab>
  </mat-tab-group>
</div>
